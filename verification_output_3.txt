
> stacklens-ai-platform@1.0.0 test:api
> playwright test tests/api

[dotenv@17.2.3] injecting env (14) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
[2m[WebServer] [22m{"level":"WARN","timestamp":"2025-11-25T19:07:36.942Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
[2m[WebServer] [22m‚ö†Ô∏è Enhanced vector service not found, using fallback similarity search

Running 102 tests using 5 workers

[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }
[dotenv@17.2.3] injecting env (0) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops
‚úì Auth state file verified
Starting authentication setup...
  ‚úì    2 [setup] ‚Ä∫ tests/auth.setup.ts:135:1 ‚Ä∫ verify auth state (472ms)
Using TEST_FIREBASE_TOKEN for authentication...
[2m[WebServer] [22m‚ö†Ô∏è Token verification failed - likely expired. Attempting to decode without verification for development mode...
‚úì Token exchange successful
‚úì Authentication successful with session token
‚úì Authentication state saved to /Users/deepak/Downloads/Projects/StackLens-AI-Deploy/tests/.auth/user.json
  ‚úì    1 [setup] ‚Ä∫ tests/auth.setup.ts:15:1 ‚Ä∫ authenticate user (2.4s)
[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
[dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
[dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`
  ‚úì    3 [api-tests] ‚Ä∫ tests/api/auth-upload.test.ts:27:5 ‚Ä∫ Authentication API ‚Ä∫ POST /api/auth/firebase-verify - should verify token (160ms)
  ‚úì    4 [api-tests] ‚Ä∫ tests/api/auth-upload.test.ts:11:5 ‚Ä∫ Authentication API ‚Ä∫ POST /api/auth/firebase-signin - should authenticate user (118ms)
  ‚úì    5 [api-tests] ‚Ä∫ tests/api/auth-upload.test.ts:68:5 ‚Ä∫ Authentication API ‚Ä∫ GET /api/auth/me - should reject unauthenticated request (79ms)
[2m[WebServer] [22mToken verification failed: Decoding Firebase ID token failed. Make sure you passed the entire string JWT which represents an ID token. See https://firebase.google.com/docs/auth/admin/verify-id-tokens for details on how to retrieve an ID token.
  ‚úì    6 [api-tests] ‚Ä∫ tests/api/auth-upload.test.ts:54:5 ‚Ä∫ Authentication API ‚Ä∫ POST /api/auth/firebase-signin - should reject invalid token (76ms)
  ‚úò    9 [api-tests] ‚Ä∫ tests/api/auth-upload.test.ts:104:5 ‚Ä∫ File Upload API ‚Ä∫ POST /api/upload - should upload CSV file (22ms)
  ‚úò    8 [api-tests] ‚Ä∫ tests/api/auth-upload.test.ts:84:5 ‚Ä∫ File Upload API ‚Ä∫ POST /api/upload - should upload Excel file (27ms)
  ‚úò   10 [api-tests] ‚Ä∫ tests/api/auth-upload.test.ts:119:5 ‚Ä∫ File Upload API ‚Ä∫ POST /api/upload - should reject invalid file type (27ms)
  ‚úò   11 [api-tests] ‚Ä∫ tests/api/auth-upload.test.ts:138:5 ‚Ä∫ File Upload API ‚Ä∫ GET /api/files - should list uploaded files (23ms)
  ‚úì    7 [api-tests] ‚Ä∫ tests/api/auth-upload.test.ts:42:5 ‚Ä∫ Authentication API ‚Ä∫ GET /api/auth/me - should return current user (75ms)
  ‚úì   12 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:25:9 ‚Ä∫ API Tests - Error Management Endpoints ‚Ä∫ GET /api/errors ‚Ä∫ should filter by severity (93ms)
  ‚úì   13 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:36:9 ‚Ä∫ API Tests - Error Management Endpoints ‚Ä∫ GET /api/errors ‚Ä∫ should filter by error type (65ms)
  ‚úì   14 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:47:9 ‚Ä∫ API Tests - Error Management Endpoints ‚Ä∫ GET /api/errors ‚Ä∫ should filter by date range (254ms)
  ‚úì   15 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:58:9 ‚Ä∫ API Tests - Error Management Endpoints ‚Ä∫ GET /api/errors ‚Ä∫ should search by message (90ms)
  ‚úì   16 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:69:9 ‚Ä∫ API Tests - Error Management Endpoints ‚Ä∫ GET /api/errors ‚Ä∫ should filter by resolved status (89ms)
  ‚úì   17 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:80:9 ‚Ä∫ API Tests - Error Management Endpoints ‚Ä∫ GET /api/errors ‚Ä∫ should filter by store (31ms)
  ‚úì   18 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:91:9 ‚Ä∫ API Tests - Error Management Endpoints ‚Ä∫ GET /api/errors ‚Ä∫ should support sorting (17ms)
  ‚úì   19 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:105:9 ‚Ä∫ API Tests - Error Management Endpoints ‚Ä∫ GET /api/errors ‚Ä∫ should handle invalid query parameters gracefully (16ms)
  ‚úì   20 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:115:9 ‚Ä∫ API Tests - Error Management Endpoints ‚Ä∫ POST /api/errors ‚Ä∫ should create new error (17ms)
  ‚úì   21 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:136:9 ‚Ä∫ API Tests - Error Management Endpoints ‚Ä∫ POST /api/errors ‚Ä∫ should validate required fields (22ms)
  ‚úì   22 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:151:9 ‚Ä∫ API Tests - Error Management Endpoints ‚Ä∫ POST /api/errors ‚Ä∫ should validate severity values (17ms)
  ‚úì   23 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:165:9 ‚Ä∫ API Tests - Error Management Endpoints ‚Ä∫ POST /api/errors ‚Ä∫ should set default values for optional fields (18ms)
  ‚úì   24 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:185:9 ‚Ä∫ API Tests - Error Management Endpoints ‚Ä∫ GET /api/errors/:id ‚Ä∫ should retrieve specific error by ID (24ms)
  ‚úì   25 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:208:9 ‚Ä∫ API Tests - Error Management Endpoints ‚Ä∫ GET /api/errors/:id ‚Ä∫ should return 404 for non-existent error (63ms)
  ‚úì   26 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:213:9 ‚Ä∫ API Tests - Error Management Endpoints ‚Ä∫ GET /api/errors/:id ‚Ä∫ should return 400 for invalid ID format (79ms)
  ‚úì   27 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:220:9 ‚Ä∫ API Tests - Error Management Endpoints ‚Ä∫ PATCH /api/errors/:id ‚Ä∫ should update error fields (88ms)
  ‚úì   28 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:253:9 ‚Ä∫ API Tests - Error Management Endpoints ‚Ä∫ PATCH /api/errors/:id ‚Ä∫ should validate updated field values (155ms)
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
  ‚úì   29 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:271:9 ‚Ä∫ API Tests - Error Management Endpoints ‚Ä∫ PATCH /api/errors/:id ‚Ä∫ should return 404 when updating non-existent error (36ms)
[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
  ‚úì   30 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:281:9 ‚Ä∫ API Tests - Error Management Endpoints ‚Ä∫ DELETE /api/errors/:id ‚Ä∫ should delete error (39ms)
  ‚úì   34 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:304:9 ‚Ä∫ API Tests - Error Management Endpoints ‚Ä∫ DELETE /api/errors/:id ‚Ä∫ should return 404 when deleting non-existent error (13ms)
  ‚úì   36 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:311:9 ‚Ä∫ API Tests - Error Management Endpoints ‚Ä∫ POST /api/errors/bulk ‚Ä∫ should create multiple errors in bulk (22ms)
  ‚úì   37 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:330:9 ‚Ä∫ API Tests - Error Management Endpoints ‚Ä∫ POST /api/errors/bulk ‚Ä∫ should handle validation errors in bulk creation (19ms)
  ‚úì   31 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:5:9 ‚Ä∫ API Tests - Error Management Endpoints ‚Ä∫ GET /api/errors ‚Ä∫ should retrieve all errors (104ms)
  ‚úì   33 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:13:9 ‚Ä∫ API Tests - Error Management Endpoints ‚Ä∫ GET /api/errors ‚Ä∫ should support pagination (92ms)
  ‚úò   32 [api-tests] ‚Ä∫ tests/api/auth-upload.test.ts:154:5 ‚Ä∫ File Upload API ‚Ä∫ GET /api/files/:id - should get file details (92ms)
  ‚úò   38 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:347:9 ‚Ä∫ API Tests - Error Management Endpoints ‚Ä∫ GET /api/errors/stats ‚Ä∫ should retrieve error statistics (17ms)
  ‚úò   35 [api-tests] ‚Ä∫ tests/api/auth-upload.test.ts:179:5 ‚Ä∫ File Upload API ‚Ä∫ DELETE /api/files/:id - should delete file (100ms)
  ‚úò   39 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:359:9 ‚Ä∫ API Tests - Error Management Endpoints ‚Ä∫ GET /api/errors/stats ‚Ä∫ should filter statistics by date range (24ms)
  ‚úì   40 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:369:9 ‚Ä∫ API Tests - Error Management Endpoints ‚Ä∫ GET /api/errors/stats ‚Ä∫ should provide statistics by store (22ms)
  ‚úì   41 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:430:9 ‚Ä∫ API Tests - Store & Kiosk Management ‚Ä∫ GET /api/stores ‚Ä∫ should support pagination for stores (21ms)
  ‚úì   42 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:438:9 ‚Ä∫ API Tests - Store & Kiosk Management ‚Ä∫ GET /api/stores ‚Ä∫ should search stores by name (17ms)
  ‚úì   43 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:446:9 ‚Ä∫ API Tests - Store & Kiosk Management ‚Ä∫ POST /api/stores ‚Ä∫ should create new store (22ms)
[2m[WebServer] [22mError creating store: SqliteError: UNIQUE constraint failed: stores.store_number
[2m[WebServer] [22m    at PreparedQuery.values [90m(/Users/deepak/Downloads/Projects/StackLens-AI-Deploy/[39mnode_modules/[4msrc[24m/better-sqlite3/session.ts:156:26[90m)[39m
[2m[WebServer] [22m    at PreparedQuery.all [90m(/Users/deepak/Downloads/Projects/StackLens-AI-Deploy/[39mnode_modules/[4msrc[24m/better-sqlite3/session.ts:124:21[90m)[39m
[2m[WebServer] [22m    at QueryPromise.all [90m(/Users/deepak/Downloads/Projects/StackLens-AI-Deploy/[39mnode_modules/[4msrc[24m/sqlite-core/query-builders/insert.ts:396:26[90m)[39m
[2m[WebServer] [22m    at QueryPromise.execute [90m(/Users/deepak/Downloads/Projects/StackLens-AI-Deploy/[39mnode_modules/[4msrc[24m/sqlite-core/query-builders/insert.ts:408:40[90m)[39m
[2m[WebServer] [22m    at QueryPromise.then [90m(/Users/deepak/Downloads/Projects/StackLens-AI-Deploy/[39mnode_modules/[4msrc[24m/query-promise.ts:31:15[90m)[39m
[2m[WebServer] [22m[90m    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)[39m {
[2m[WebServer] [22m  code: [32m'SQLITE_CONSTRAINT_UNIQUE'[39m
[2m[WebServer] [22m}
  ‚úì   44 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:463:9 ‚Ä∫ API Tests - Store & Kiosk Management ‚Ä∫ POST /api/stores ‚Ä∫ should prevent duplicate store numbers (26ms)
  ‚úì   45 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:481:9 ‚Ä∫ API Tests - Store & Kiosk Management ‚Ä∫ GET /api/kiosks ‚Ä∫ should retrieve all kiosks (19ms)
  ‚úì   46 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:489:9 ‚Ä∫ API Tests - Store & Kiosk Management ‚Ä∫ GET /api/kiosks ‚Ä∫ should filter kiosks by store (17ms)
  ‚úò   47 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:501:9 ‚Ä∫ API Tests - Store & Kiosk Management ‚Ä∫ POST /api/kiosks ‚Ä∫ should create new kiosk (28ms)
[dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
  ‚úì   49 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:405:9 ‚Ä∫ API Tests - Error Management Endpoints ‚Ä∫ POST /api/errors/export ‚Ä∫ should export errors as Excel (94ms)
  ‚úì   48 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:379:9 ‚Ä∫ API Tests - Error Management Endpoints ‚Ä∫ POST /api/errors/export ‚Ä∫ should export errors as CSV (105ms)
  ‚úì   50 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:392:9 ‚Ä∫ API Tests - Error Management Endpoints ‚Ä∫ POST /api/errors/export ‚Ä∫ should export errors as JSON (110ms)
  ‚úì   52 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:535:9 ‚Ä∫ API Tests - ML Training Endpoints ‚Ä∫ POST /api/ml/train ‚Ä∫ should initiate ML training job (127ms)
  ‚úì   53 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:554:9 ‚Ä∫ API Tests - ML Training Endpoints ‚Ä∫ POST /api/ml/train ‚Ä∫ should validate training configuration (136ms)
  ‚úì   54 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:568:9 ‚Ä∫ API Tests - ML Training Endpoints ‚Ä∫ GET /api/ml/jobs/:jobId ‚Ä∫ should retrieve training job status (40ms)
  ‚úì   51 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:422:9 ‚Ä∫ API Tests - Store & Kiosk Management ‚Ä∫ GET /api/stores ‚Ä∫ should retrieve all stores (186ms)
  ‚úì   56 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:615:9 ‚Ä∫ API Tests - ML Training Endpoints ‚Ä∫ GET /api/ml/models ‚Ä∫ should list all trained models (53ms)
  ‚úì   57 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:623:9 ‚Ä∫ API Tests - ML Training Endpoints ‚Ä∫ GET /api/ml/models ‚Ä∫ should filter models by status (55ms)
  ‚úì   55 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:594:9 ‚Ä∫ API Tests - ML Training Endpoints ‚Ä∫ POST /api/ml/predict ‚Ä∫ should make prediction with trained model (69ms)
  ‚úì   59 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:655:9 ‚Ä∫ API Tests - AI Analysis Endpoints ‚Ä∫ POST /api/ai/analyze ‚Ä∫ should handle timeout for long-running analysis (47ms)
  ‚úì   58 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:637:9 ‚Ä∫ API Tests - AI Analysis Endpoints ‚Ä∫ POST /api/ai/analyze ‚Ä∫ should analyze error with AI (75ms)
  ‚úì   61 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:685:9 ‚Ä∫ API Tests - AI Analysis Endpoints ‚Ä∫ POST /api/ai/summarize ‚Ä∫ should summarize multiple errors (44ms)
  ‚úò   62 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:707:9 ‚Ä∫ API Tests - File Upload & Processing ‚Ä∫ POST /api/upload ‚Ä∫ should handle Excel file upload (32ms)
  ‚úì   64 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:742:9 ‚Ä∫ API Tests - File Upload & Processing ‚Ä∫ POST /api/upload ‚Ä∫ should reject unsupported file types (33ms)
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
  ‚úò   65 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:785:9 ‚Ä∫ API Tests - Authentication & Authorization ‚Ä∫ POST /api/auth/firebase ‚Ä∫ should authenticate with valid Firebase token (32ms)
  ‚úò   63 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:726:9 ‚Ä∫ API Tests - File Upload & Processing ‚Ä∫ POST /api/upload ‚Ä∫ should reject files exceeding size limit (57ms)
  ‚úì   60 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:666:9 ‚Ä∫ API Tests - AI Analysis Endpoints ‚Ä∫ POST /api/ai/suggest ‚Ä∫ should provide fix suggestions (155ms)
  ‚úì   66 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:831:9 ‚Ä∫ API Tests - Authentication & Authorization ‚Ä∫ GET /api/admin/users ‚Ä∫ should require admin role (26ms)
[2m[WebServer] [22mToken verification failed: Decoding Firebase ID token failed. Make sure you passed the entire string JWT which represents an ID token. See https://firebase.google.com/docs/auth/admin/verify-id-tokens for details on how to retrieve an ID token.
Auth response: {
  user: {
    id: [33m1[39m,
    username: [32m'Test User'[39m,
    email: [32m'test@stacklens.ai'[39m,
    role: [32m'admin'[39m,
    firstName: [32m'Test'[39m,
    lastName: [32m'User'[39m,
    profileImageUrl: [32m'https://example.com/avatar.jpg'[39m,
    department: [1mnull[22m,
    isActive: [33mtrue[39m,
    lastLogin: [32m'2025-11-25T19:07:50.000Z'[39m,
    createdAt: [32m'+057872-01-12T00:20:00.000Z'[39m,
    updatedAt: [32m'+057872-01-12T00:20:00.000Z'[39m
  },
  token: [32m'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjEsImlhdCI6MTc2NDA5NzY3MCwiZXhwIjoxNzY0MTg0MDcwfQ.CF7mXeYcv1cfxsu-o2kkZxQN84mKwJHYRci9jz2P348'[39m,
  provider: [32m'firebase'[39m
}
  ‚úì   68 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:838:9 ‚Ä∫ API Tests - Authentication & Authorization ‚Ä∫ GET /api/admin/users ‚Ä∫ should allow access with admin token (19ms)
  ‚úì   69 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:871:5 ‚Ä∫ API Tests - Request Validation ‚Ä∫ should reject requests with invalid Content-Type (17ms)
  ‚úì   67 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:517:9 ‚Ä∫ API Tests - Store & Kiosk Management ‚Ä∫ POST /api/kiosks ‚Ä∫ should validate kiosk belongs to valid store (81ms)
[2m[WebServer] [22m‚ùå Server error: SyntaxError: Unexpected token '"', ""{invalid json}"" is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m    at createStrictSyntaxError [90m(/Users/deepak/Downloads/Projects/StackLens-AI-Deploy/[39mnode_modules/[4mbody-parser[24m/lib/types/json.js:169:10[90m)[39m
[2m[WebServer] [22m    at parse [90m(/Users/deepak/Downloads/Projects/StackLens-AI-Deploy/[39mnode_modules/[4mbody-parser[24m/lib/types/json.js:86:15[90m)[39m
[2m[WebServer] [22m    at [90m/Users/deepak/Downloads/Projects/StackLens-AI-Deploy/[39mnode_modules/[4mbody-parser[24m/lib/read.js:128:18
[2m[WebServer] [22m[90m    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)[39m
[2m[WebServer] [22m    at invokeCallback [90m(/Users/deepak/Downloads/Projects/StackLens-AI-Deploy/[39mnode_modules/[4mraw-body[24m/index.js:238:16[90m)[39m
[2m[WebServer] [22m    at done [90m(/Users/deepak/Downloads/Projects/StackLens-AI-Deploy/[39mnode_modules/[4mraw-body[24m/index.js:227:7[90m)[39m
[2m[WebServer] [22m    at IncomingMessage.onEnd [90m(/Users/deepak/Downloads/Projects/StackLens-AI-Deploy/[39mnode_modules/[4mraw-body[24m/index.js:287:7[90m)[39m
[2m[WebServer] [22m[90m    at IncomingMessage.emit (node:events:518:28)[39m
[2m[WebServer] [22m[90m    at endReadableNT (node:internal/streams/readable:1698:12)[39m {
[2m[WebServer] [22m  expose: [33mtrue[39m,
[2m[WebServer] [22m  statusCode: [33m400[39m,
[2m[WebServer] [22m  status: [33m400[39m,
[2m[WebServer] [22m  body: [32m'"{invalid json}"'[39m,
[2m[WebServer] [22m  type: [32m'entity.parse.failed'[39m
[2m[WebServer] [22m}
  ‚úì   70 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:882:5 ‚Ä∫ API Tests - Request Validation ‚Ä∫ should validate JSON syntax (19ms)
  ‚úì   72 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:907:5 ‚Ä∫ API Tests - Request Validation ‚Ä∫ should validate required headers (260ms)
  ‚úò   71 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:893:5 ‚Ä∫ API Tests - Request Validation ‚Ä∫ should enforce maximum payload size (222ms)
  ‚úì   73 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:918:5 ‚Ä∫ API Tests - Request Validation ‚Ä∫ should handle missing request body (450ms)
  ‚úì   74 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:930:5 ‚Ä∫ API Tests - Request Validation ‚Ä∫ should handle special characters in query params (30ms)
  ‚úì   75 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:941:5 ‚Ä∫ API Tests - Response Format Validation ‚Ä∫ should return proper Content-Type headers (43ms)
  ‚úì   76 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:948:5 ‚Ä∫ API Tests - Response Format Validation ‚Ä∫ should include CORS headers (46ms)
  ‚úì   77 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:959:5 ‚Ä∫ API Tests - Response Format Validation ‚Ä∫ should return consistent error response format (45ms)
  ‚úì   78 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:969:5 ‚Ä∫ API Tests - Response Format Validation ‚Ä∫ should include pagination metadata (68ms)
  ‚úì   79 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:981:5 ‚Ä∫ API Tests - Response Format Validation ‚Ä∫ should return timestamps in ISO format (45ms)
  ‚úì   80 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:995:5 ‚Ä∫ API Tests - Error Handling ‚Ä∫ should handle database connection errors gracefully (41ms)
  ‚úì   81 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:1003:5 ‚Ä∫ API Tests - Error Handling ‚Ä∫ should return 404 for non-existent routes (17ms)
  ‚úì   82 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:1009:5 ‚Ä∫ API Tests - Error Handling ‚Ä∫ should handle malformed route parameters (13ms)
  ‚úò   83 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:1015:5 ‚Ä∫ API Tests - Error Handling ‚Ä∫ should provide helpful error messages (18ms)
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }
  ‚úò   84 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:760:9 ‚Ä∫ API Tests - File Upload & Processing ‚Ä∫ GET /api/uploads/:fileId ‚Ä∫ should retrieve upload status (210ms)
[2m[WebServer] [22mToken verification failed: Decoding Firebase ID token failed. Make sure you passed the entire string JWT which represents an ID token. See https://firebase.google.com/docs/auth/admin/verify-id-tokens for details on how to retrieve an ID token.
[2m[WebServer] [22mToken verification failed: Decoding Firebase ID token failed. Make sure you passed the entire string JWT which represents an ID token. See https://firebase.google.com/docs/auth/admin/verify-id-tokens for details on how to retrieve an ID token.
  ‚úì   85 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:799:9 ‚Ä∫ API Tests - Authentication & Authorization ‚Ä∫ POST /api/auth/firebase ‚Ä∫ should reject invalid token (208ms)
  ‚úò   86 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:811:9 ‚Ä∫ API Tests - Authentication & Authorization ‚Ä∫ POST /api/auth/logout ‚Ä∫ should logout user (294ms)
[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit
  ‚úì   87 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:1057:5 ‚Ä∫ API Tests - Rate Limiting ‚Ä∫ should include rate limit headers (121ms)
  ‚úì   88 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:1093:5 ‚Ä∫ API Tests - Pagination Edge Cases ‚Ä∫ should handle page=0 (117ms)
  ‚úì   90 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:1100:5 ‚Ä∫ API Tests - Pagination Edge Cases ‚Ä∫ should handle negative page numbers (14ms)
  ‚úì   91 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:1106:5 ‚Ä∫ API Tests - Pagination Edge Cases ‚Ä∫ should handle excessive page numbers (25ms)
  ‚úò   89 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:924:5 ‚Ä∫ API Tests - Request Validation ‚Ä∫ should validate URL parameter formats (444ms)
  ‚úò   92 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:1116:5 ‚Ä∫ API Tests - Pagination Edge Cases ‚Ä∫ should handle limit=0 (333ms)
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
  ‚úì   93 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:1027:5 ‚Ä∫ API Tests - Error Handling ‚Ä∫ should handle concurrent request failures (940ms)
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }
  ‚úì   95 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:1147:5 ‚Ä∫ API Tests - Concurrent Operations ‚Ä∫ should handle concurrent writes with proper isolation (103ms)
  ‚úò   97 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:1164:5 ‚Ä∫ API Tests - Concurrent Operations ‚Ä∫ should prevent race conditions on updates (87ms)
[dotenv@17.2.3] injecting env (0) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
[dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`
  ‚úò   94 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:1041:5 ‚Ä∫ API Tests - Rate Limiting ‚Ä∫ should implement rate limiting (6.9s)
[dotenv@17.2.3] injecting env (0) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops
  ‚úò   98 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:1136:5 ‚Ä∫ API Tests - Concurrent Operations ‚Ä∫ should handle concurrent reads safely (8.4s)
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
  ‚úì   99 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:1122:5 ‚Ä∫ API Tests - Pagination Edge Cases ‚Ä∫ should enforce maximum limit (11.8s)
  ‚úì  101 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:1208:5 ‚Ä∫ API Tests - Cache Control ‚Ä∫ should respect If-None-Match for conditional requests (6.2s)
  ‚úì   96 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:1073:5 ‚Ä∫ API Tests - Rate Limiting ‚Ä∫ should reset rate limits after time window (13.4s)
  ‚úì  102 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:1223:5 ‚Ä∫ API Tests - Cache Control ‚Ä∫ should support If-Modified-Since (4.1s)
  ‚úì  100 [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:1197:5 ‚Ä∫ API Tests - Cache Control ‚Ä∫ should include appropriate cache headers (10.2s)


  1) [api-tests] ‚Ä∫ tests/api/auth-upload.test.ts:84:5 ‚Ä∫ File Upload API ‚Ä∫ POST /api/upload - should upload Excel file 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBe[2m([22m[32mexpected[39m[2m) // Object.is equality[22m

    Expected: [32m200[39m
    Received: [31m400[39m

      94 |         });
      95 |
    > 96 |         expect(response.status()).toBe(200);
         |                                   ^
      97 |
      98 |         const data = await response.json();
      99 |         expect(data).toHaveProperty('fileId');
        at /Users/deepak/Downloads/Projects/StackLens-AI-Deploy/tests/api/auth-upload.test.ts:96:35

  2) [api-tests] ‚Ä∫ tests/api/auth-upload.test.ts:104:5 ‚Ä∫ File Upload API ‚Ä∫ POST /api/upload - should upload CSV file 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBe[2m([22m[32mexpected[39m[2m) // Object.is equality[22m

    Expected: [32m200[39m
    Received: [31m400[39m

      114 |         });
      115 |
    > 116 |         expect(response.status()).toBe(200);
          |                                   ^
      117 |     });
      118 |
      119 |     test('POST /api/upload - should reject invalid file type', async ({ apiContext }) => {
        at /Users/deepak/Downloads/Projects/StackLens-AI-Deploy/tests/api/auth-upload.test.ts:116:35

  3) [api-tests] ‚Ä∫ tests/api/auth-upload.test.ts:119:5 ‚Ä∫ File Upload API ‚Ä∫ POST /api/upload - should reject invalid file type 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoContain[2m([22m[32mexpected[39m[2m) // indexOf[22m

    Expected substring: [32m"Invalid file type"[39m
    Received string:    [31m"No file uploaded"[39m

      133 |         const data = await response.json();
      134 |         expect(data).toHaveProperty('message');
    > 135 |         expect(data.message).toContain('Invalid file type');
          |                              ^
      136 |     });
      137 |
      138 |     test('GET /api/files - should list uploaded files', async ({ apiContext }) => {
        at /Users/deepak/Downloads/Projects/StackLens-AI-Deploy/tests/api/auth-upload.test.ts:135:30

  4) [api-tests] ‚Ä∫ tests/api/auth-upload.test.ts:138:5 ‚Ä∫ File Upload API ‚Ä∫ GET /api/files - should list uploaded files 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBe[2m([22m[32mexpected[39m[2m) // Object.is equality[22m

    Expected: [32mtrue[39m
    Received: [31mfalse[39m

      143 |
      144 |         const data = await response.json();
    > 145 |         expect(Array.isArray(data)).toBe(true);
          |                                     ^
      146 |
      147 |         if (data.length > 0) {
      148 |             expect(data[0]).toHaveProperty('id');
        at /Users/deepak/Downloads/Projects/StackLens-AI-Deploy/tests/api/auth-upload.test.ts:145:37

  5) [api-tests] ‚Ä∫ tests/api/auth-upload.test.ts:154:5 ‚Ä∫ File Upload API ‚Ä∫ GET /api/files/:id - should get file details 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBe[2m([22m[32mexpected[39m[2m) // Object.is equality[22m

    Expected: [32m200[39m
    Received: [31m400[39m

      170 |         const response = await apiContext.get(`/api/files/${fileId}`);
      171 |
    > 172 |         expect(response.status()).toBe(200);
          |                                   ^
      173 |
      174 |         const data = await response.json();
      175 |         expect(data).toHaveProperty('id', fileId);
        at /Users/deepak/Downloads/Projects/StackLens-AI-Deploy/tests/api/auth-upload.test.ts:172:35

  6) [api-tests] ‚Ä∫ tests/api/auth-upload.test.ts:179:5 ‚Ä∫ File Upload API ‚Ä∫ DELETE /api/files/:id - should delete file 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBe[2m([22m[32mexpected[39m[2m) // Object.is equality[22m

    Expected: [32m200[39m
    Received: [31m400[39m

      195 |         const response = await apiContext.delete(`/api/files/${fileId}`);
      196 |
    > 197 |         expect(response.status()).toBe(200);
          |                                   ^
      198 |
      199 |         const data = await response.json();
      200 |         expect(data).toHaveProperty('message', 'File deleted successfully');
        at /Users/deepak/Downloads/Projects/StackLens-AI-Deploy/tests/api/auth-upload.test.ts:197:35

  7) [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:347:9 ‚Ä∫ API Tests - Error Management Endpoints ‚Ä∫ GET /api/errors/stats ‚Ä∫ should retrieve error statistics 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBeTruthy[2m()[22m

    Received: [31mfalse[39m

      348 |             const response = await apiContext.get('/api/errors/stats');
      349 |
    > 350 |             expect(response.ok()).toBeTruthy();
          |                                   ^
      351 |             const stats = await response.json();
      352 |             expect(stats).toHaveProperty('total');
      353 |             expect(stats).toHaveProperty('bySeverity');
        at /Users/deepak/Downloads/Projects/StackLens-AI-Deploy/tests/api/comprehensive.test.ts:350:35

  8) [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:359:9 ‚Ä∫ API Tests - Error Management Endpoints ‚Ä∫ GET /api/errors/stats ‚Ä∫ should filter statistics by date range 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBeTruthy[2m()[22m

    Received: [31mfalse[39m

      362 |             );
      363 |
    > 364 |             expect(response.ok()).toBeTruthy();
          |                                   ^
      365 |             const stats = await response.json();
      366 |             expect(stats).toHaveProperty('dateRange');
      367 |         });
        at /Users/deepak/Downloads/Projects/StackLens-AI-Deploy/tests/api/comprehensive.test.ts:364:35

  9) [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:501:9 ‚Ä∫ API Tests - Store & Kiosk Management ‚Ä∫ POST /api/kiosks ‚Ä∫ should create new kiosk 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBeTruthy[2m()[22m

    Received: [31mfalse[39m

      510 |             });
      511 |
    > 512 |             expect(response.ok()).toBeTruthy();
          |                                   ^
      513 |             const created = await response.json();
      514 |             expect(created.kioskNumber).toBe(newKiosk.kioskNumber);
      515 |         });
        at /Users/deepak/Downloads/Projects/StackLens-AI-Deploy/tests/api/comprehensive.test.ts:512:35

  10) [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:707:9 ‚Ä∫ API Tests - File Upload & Processing ‚Ä∫ POST /api/upload ‚Ä∫ should handle Excel file upload 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBeTruthy[2m()[22m

    Received: [31mfalse[39m

      718 |             });
      719 |
    > 720 |             expect(response.ok()).toBeTruthy();
          |                                   ^
      721 |             const result = await response.json();
      722 |             expect(result).toHaveProperty('fileId');
      723 |             expect(result).toHaveProperty('filename');
        at /Users/deepak/Downloads/Projects/StackLens-AI-Deploy/tests/api/comprehensive.test.ts:720:35

  11) [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:726:9 ‚Ä∫ API Tests - File Upload & Processing ‚Ä∫ POST /api/upload ‚Ä∫ should reject files exceeding size limit 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBe[2m([22m[32mexpected[39m[2m) // Object.is equality[22m

    Expected: [32m413[39m
    Received: [31m400[39m

      737 |             });
      738 |
    > 739 |             expect(response.status()).toBe(413); // Payload Too Large
          |                                       ^
      740 |         });
      741 |
      742 |         test('should reject unsupported file types', async ({ apiContext }) => {
        at /Users/deepak/Downloads/Projects/StackLens-AI-Deploy/tests/api/comprehensive.test.ts:739:39

  12) [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:760:9 ‚Ä∫ API Tests - File Upload & Processing ‚Ä∫ GET /api/uploads/:fileId ‚Ä∫ should retrieve upload status 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBeTruthy[2m()[22m

    Received: [31mfalse[39m

      771 |             // Check status
      772 |             const statusResponse = await apiContext.get(`/api/uploads/${upload.fileId}`);
    > 773 |             expect(statusResponse.ok()).toBeTruthy();
          |                                         ^
      774 |
      775 |             const status = await statusResponse.json();
      776 |             expect(status).toHaveProperty('fileId');
        at /Users/deepak/Downloads/Projects/StackLens-AI-Deploy/tests/api/comprehensive.test.ts:773:41

  13) [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:785:9 ‚Ä∫ API Tests - Authentication & Authorization ‚Ä∫ POST /api/auth/firebase ‚Ä∫ should authenticate with valid Firebase token 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoHaveProperty[2m([22m[32mpath[39m[2m)[22m

    Expected path: [32m"sessionToken"[39m
    Received path: [31m[][39m

    Received value: [31m{"email": "test@stacklens.ai", "provider": "firebase", "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjEsImlhdCI6MTc2NDA5NzY2OSwiZXhwIjoxNzY0MTg0MDY5fQ.vfo90wMkk6P_sdeL1Ei3Y8zXXF0EPEP0Km9jr1CGFDg", "user": {"createdAt": "+057872-01-12T00:20:00.000Z", "department": null, "email": "test@stacklens.ai", "firstName": "Test", "id": 1, "isActive": true, "lastLogin": "2025-11-25T19:07:49.000Z", "lastName": "User", "profileImageUrl": "https://example.com/photo.jpg", "role": "admin", "updatedAt": "+057872-01-12T00:20:00.000Z", "username": "Test User"}, "userId": 1}[39m

      794 |             expect(auth).toHaveProperty('userId');
      795 |             expect(auth).toHaveProperty('email');
    > 796 |             expect(auth).toHaveProperty('sessionToken');
          |                          ^
      797 |         });
      798 |
      799 |         test('should reject invalid token', async ({ apiContext }) => {
        at /Users/deepak/Downloads/Projects/StackLens-AI-Deploy/tests/api/comprehensive.test.ts:796:26

  14) [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:811:9 ‚Ä∫ API Tests - Authentication & Authorization ‚Ä∫ POST /api/auth/logout ‚Ä∫ should logout user 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBeTruthy[2m()[22m

    Received: [31mfalse[39m

      824 |             });
      825 |
    > 826 |             expect(logoutResponse.ok()).toBeTruthy();
          |                                         ^
      827 |         });
      828 |     });
      829 |
        at /Users/deepak/Downloads/Projects/StackLens-AI-Deploy/tests/api/comprehensive.test.ts:826:41

  15) [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:893:5 ‚Ä∫ API Tests - Request Validation ‚Ä∫ should enforce maximum payload size 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoContain[2m([22m[32mexpected[39m[2m) // indexOf[22m

    Expected value: [32m201[39m
    Received array: [31m[413, 400][39m

      902 |         });
      903 |
    > 904 |         expect([413, 400]).toContain(response.status());
          |                            ^
      905 |     });
      906 |
      907 |     test('should validate required headers', async ({ apiContext }) => {
        at /Users/deepak/Downloads/Projects/StackLens-AI-Deploy/tests/api/comprehensive.test.ts:904:28

  16) [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:924:5 ‚Ä∫ API Tests - Request Validation ‚Ä∫ should validate URL parameter formats 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoContain[2m([22m[32mexpected[39m[2m) // indexOf[22m

    Expected value: [32m200[39m
    Received array: [31m[400, 422][39m

      925 |         const response = await apiContext.get('/api/errors?page=invalid');
      926 |
    > 927 |         expect([400, 422]).toContain(response.status());
          |                            ^
      928 |     });
      929 |
      930 |     test('should handle special characters in query params', async ({ apiContext }) => {
        at /Users/deepak/Downloads/Projects/StackLens-AI-Deploy/tests/api/comprehensive.test.ts:927:28

  17) [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:1015:5 ‚Ä∫ API Tests - Error Handling ‚Ä∫ should provide helpful error messages 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBeTruthy[2m()[22m

    Received: [31mundefined[39m

      1021 |         const error = await response.json();
      1022 |
    > 1023 |         expect(error.message).toBeTruthy();
           |                               ^
      1024 |         expect(error.message.length).toBeGreaterThan(0);
      1025 |     });
      1026 |
        at /Users/deepak/Downloads/Projects/StackLens-AI-Deploy/tests/api/comprehensive.test.ts:1023:31

  18) [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:1041:5 ‚Ä∫ API Tests - Rate Limiting ‚Ä∫ should implement rate limiting 

    Error: apiRequestContext.get: Parse Error: Expected HTTP/, RTSP/ or ICE/
    Call log:
    [2m  - ‚Üí GET http://localhost:4001/api/errors[22m
    [2m    - user-agent: Playwright/1.57.0 (arm64; macOS 15.6) node/22.17[22m
    [2m    - accept: */*[22m
    [2m    - accept-encoding: gzip,deflate,br[22m
    [2m    - Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjEsImlhdCI6MTc2NDA5NzY2MiwiZXhwIjoxNzY0MTg0MDYyfQ.TcG1NOZ2Vop39N6qMlvIihiYErM6HvHsVBgk5h-fpeA[22m
    [2m    - Content-Type: application/json[22m
    [2m    - x-test-force-ratelimit: true[22m
    [2m  - ‚Üê 200 OK[22m
    [2m    - x-powered-by: Express[22m
    [2m    - vary: Origin[22m
    [2m    - access-control-allow-credentials: true[22m
    [2m    - ratelimit-policy: 100;w=1[22m
    [2m    - ratelimit-limit: 100[22m
    [2m    - ratelimit-remaining: 76[22m
    [2m    - ratelimit-reset: 1[22m
    [2m    - content-type: application/json; charset=utf-8[22m
    [2m    - content-length: 3009604[22m
    [2m    - etag: W/"2dec44-YqSyzd7eJaLlIszv+r3zJMnxohE"[22m
    [2m    - date: Tue, 25 Nov 2025 19:07:55 GMT[22m
    [2m    - connection: keep-alive[22m
    [2m    - keep-alive: timeout=5[22m


      1041 |     test('should implement rate limiting', async ({ apiContext }) => {
      1042 |         const requests = Array.from({ length: 150 }, () =>
    > 1043 |             apiContext.get('/api/errors', {
           |                        ^
      1044 |                 headers: { 'x-test-force-ratelimit': 'true' }
      1045 |             })
      1046 |         );
        at from (/Users/deepak/Downloads/Projects/StackLens-AI-Deploy/tests/api/comprehensive.test.ts:1043:24)
        at /Users/deepak/Downloads/Projects/StackLens-AI-Deploy/tests/api/comprehensive.test.ts:1042:32

  19) [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:1116:5 ‚Ä∫ API Tests - Pagination Edge Cases ‚Ä∫ should handle limit=0 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoContain[2m([22m[32mexpected[39m[2m) // indexOf[22m

    Expected value: [32m200[39m
    Received array: [31m[400, 422][39m

      1117 |         const response = await apiContext.get('/api/errors?page=1&limit=0');
      1118 |
    > 1119 |         expect([400, 422]).toContain(response.status());
           |                            ^
      1120 |     });
      1121 |
      1122 |     test('should enforce maximum limit', async ({ apiContext }) => {
        at /Users/deepak/Downloads/Projects/StackLens-AI-Deploy/tests/api/comprehensive.test.ts:1119:28

  20) [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:1136:5 ‚Ä∫ API Tests - Concurrent Operations ‚Ä∫ should handle concurrent reads safely 

    Error: apiRequestContext.get: connect ETIMEDOUT ::1:4001
    Call log:
    [2m  - ‚Üí GET http://localhost:4001/api/errors[22m
    [2m    - user-agent: Playwright/1.57.0 (arm64; macOS 15.6) node/22.17[22m
    [2m    - accept: */*[22m
    [2m    - accept-encoding: gzip,deflate,br[22m
    [2m    - Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjEsImlhdCI6MTc2NDA5NzY2MiwiZXhwIjoxNzY0MTg0MDYyfQ.TcG1NOZ2Vop39N6qMlvIihiYErM6HvHsVBgk5h-fpeA[22m
    [2m    - Content-Type: application/json[22m

        at apiRequestContext.get: connect ETIMEDOUT ::1:4001
        at from (/Users/deepak/Downloads/Projects/StackLens-AI-Deploy/tests/api/comprehensive.test.ts:1138:24)
        at /Users/deepak/Downloads/Projects/StackLens-AI-Deploy/tests/api/comprehensive.test.ts:1137:32

  21) [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:1164:5 ‚Ä∫ API Tests - Concurrent Operations ‚Ä∫ should prevent race conditions on updates 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoContain[2m([22m[32mexpected[39m[2m) // indexOf[22m

    Expected value: [32m404[39m
    Received array: [31m[200, 409][39m

      1189 |         // All should succeed or have proper conflict handling
      1190 |         responses.forEach(r => {
    > 1191 |             expect([200, 409]).toContain(r.status());
           |                                ^
      1192 |         });
      1193 |     });
      1194 | });
        at forEach (/Users/deepak/Downloads/Projects/StackLens-AI-Deploy/tests/api/comprehensive.test.ts:1191:32)
        at /Users/deepak/Downloads/Projects/StackLens-AI-Deploy/tests/api/comprehensive.test.ts:1190:19

  21 failed
    [api-tests] ‚Ä∫ tests/api/auth-upload.test.ts:84:5 ‚Ä∫ File Upload API ‚Ä∫ POST /api/upload - should upload Excel file 
    [api-tests] ‚Ä∫ tests/api/auth-upload.test.ts:104:5 ‚Ä∫ File Upload API ‚Ä∫ POST /api/upload - should upload CSV file 
    [api-tests] ‚Ä∫ tests/api/auth-upload.test.ts:119:5 ‚Ä∫ File Upload API ‚Ä∫ POST /api/upload - should reject invalid file type 
    [api-tests] ‚Ä∫ tests/api/auth-upload.test.ts:138:5 ‚Ä∫ File Upload API ‚Ä∫ GET /api/files - should list uploaded files 
    [api-tests] ‚Ä∫ tests/api/auth-upload.test.ts:154:5 ‚Ä∫ File Upload API ‚Ä∫ GET /api/files/:id - should get file details 
    [api-tests] ‚Ä∫ tests/api/auth-upload.test.ts:179:5 ‚Ä∫ File Upload API ‚Ä∫ DELETE /api/files/:id - should delete file 
    [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:347:9 ‚Ä∫ API Tests - Error Management Endpoints ‚Ä∫ GET /api/errors/stats ‚Ä∫ should retrieve error statistics 
    [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:359:9 ‚Ä∫ API Tests - Error Management Endpoints ‚Ä∫ GET /api/errors/stats ‚Ä∫ should filter statistics by date range 
    [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:501:9 ‚Ä∫ API Tests - Store & Kiosk Management ‚Ä∫ POST /api/kiosks ‚Ä∫ should create new kiosk 
    [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:707:9 ‚Ä∫ API Tests - File Upload & Processing ‚Ä∫ POST /api/upload ‚Ä∫ should handle Excel file upload 
    [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:726:9 ‚Ä∫ API Tests - File Upload & Processing ‚Ä∫ POST /api/upload ‚Ä∫ should reject files exceeding size limit 
    [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:760:9 ‚Ä∫ API Tests - File Upload & Processing ‚Ä∫ GET /api/uploads/:fileId ‚Ä∫ should retrieve upload status 
    [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:785:9 ‚Ä∫ API Tests - Authentication & Authorization ‚Ä∫ POST /api/auth/firebase ‚Ä∫ should authenticate with valid Firebase token 
    [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:811:9 ‚Ä∫ API Tests - Authentication & Authorization ‚Ä∫ POST /api/auth/logout ‚Ä∫ should logout user 
    [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:893:5 ‚Ä∫ API Tests - Request Validation ‚Ä∫ should enforce maximum payload size 
    [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:924:5 ‚Ä∫ API Tests - Request Validation ‚Ä∫ should validate URL parameter formats 
    [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:1015:5 ‚Ä∫ API Tests - Error Handling ‚Ä∫ should provide helpful error messages 
    [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:1041:5 ‚Ä∫ API Tests - Rate Limiting ‚Ä∫ should implement rate limiting 
    [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:1116:5 ‚Ä∫ API Tests - Pagination Edge Cases ‚Ä∫ should handle limit=0 
    [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:1136:5 ‚Ä∫ API Tests - Concurrent Operations ‚Ä∫ should handle concurrent reads safely 
    [api-tests] ‚Ä∫ tests/api/comprehensive.test.ts:1164:5 ‚Ä∫ API Tests - Concurrent Operations ‚Ä∫ should prevent race conditions on updates 
  81 passed (34.0s)

[36m  Serving HTML report at http://localhost:51159. Press Ctrl+C to quit.[39m
