# Phase 3: Advanced Enrichment Service - Quick Start Guide\n\n**Getting started with Phase 3 in 5 minutes!**\n\n## Quick Start Steps\n\n### 1. Start Docker Compose\n\n```bash\ncd /Users/deepak/Downloads/Projects/StackLens-AI-Deploy\n\n# Start all Phase 3 services\ndocker-compose -f docker-compose-phase3.yml up -d\n\n# Wait for services to be ready (30-60 seconds)\nsleep 30\n\n# Verify all services are running\ndocker-compose -f docker-compose-phase3.yml ps\n```\n\n**Expected Output**:\n```\nNAME                          STATUS\nstacklens-zookeeper           Up 30s (healthy)\nstacklens-kafka               Up 20s (healthy)\nstacklens-postgres            Up 20s (healthy)\nstacklens-enrichment-api      Up 15s (healthy)\nstacklens-enrichment-service  Up 10s (healthy)\nstacklens-kafka-ui            Up 5s\n```\n\n### 2. Verify Services\n\n```bash\n# Check Enrichment Service health\ncurl http://localhost:8003/health\n\n# Check User Service health\ncurl http://localhost:8002/health\n\n# Check PostgreSQL\npsql -h localhost -U stacklens_user -d stacklens -c \"SELECT COUNT(*) FROM geo_ip_cache;\"\n```\n\n### 3. Send Test Message\n\n```bash\n# Produce test message to Kafka\nkafka-console-producer --broker-list localhost:9092 --topic stacklens-enriched << EOF\n{\"timestamp\":\"2024-01-15T10:00:00Z\",\"service\":\"payment-service\",\"level\":\"info\",\"message\":\"Payment processed\",\"trace_id\":\"trace-123\",\"span_id\":\"span-456\",\"source_ip\":\"8.8.8.8\",\"user_id\":\"user-123\",\"request_id\":\"req-789\"}\nEOF\n```\n\n### 4. Consume Enriched Message\n\n```bash\n# Read enriched message from output topic\nkafka-console-consumer --bootstrap-server localhost:9092 \\\n  --topic stacklens-analytics --from-beginning --max-messages 1\n```\n\n**Expected Output**:\n```json\n{\n  \"timestamp\": \"2024-01-15T10:00:00Z\",\n  \"service\": \"payment-service\",\n  \"level\": \"info\",\n  \"message\": \"Payment processed\",\n  \"source_ip\": \"8.8.8.8\",\n  \"user_id\": \"user-123\",\n  \"geo_country\": \"United States\",\n  \"geo_city\": \"Mountain View\",\n  \"geo_latitude\": 37.386,\n  \"geo_longitude\": -122.084,\n  \"user_subscription_tier\": \"premium\",\n  \"user_account_age_days\": 365,\n  \"business_risk_score\": 0.15,\n  \"enrichment_sources\": [\"geo-ip\", \"user-profile\", \"business-context\"]\n}\n```\n\n### 5. View Cache Data\n\n```bash\n# Connect to PostgreSQL\npsql -h localhost -U stacklens_user -d stacklens\n\n# Inside psql:\n-- View cached geo IP\nSELECT ip_address, country_name, city FROM geo_ip_cache;\n\n-- View cached user profiles\nSELECT user_id, username, subscription_tier FROM user_profile_cache;\n\n-- View enrichment metrics\nSELECT * FROM enrichment_metrics ORDER BY recorded_at DESC LIMIT 1;\n\n-- Exit\n\\q\n```\n\n## Service Endpoints\n\n### Enrichment Service\n- **URL**: `http://localhost:8003`\n- **Health Check**: `GET http://localhost:8003/health`\n- **Metrics**: `GET http://localhost:8003/metrics` (Prometheus format)\n\n### User Service (Mock)\n- **URL**: `http://localhost:8002`\n- **Health Check**: `GET http://localhost:8002/health`\n- **User Lookup**: `GET http://localhost:8002/api/users/{user_id}`\n- **Batch Lookup**: `POST http://localhost:8002/api/users/batch`\n- **Stats**: `GET http://localhost:8002/api/stats`\n\n**Example User IDs**: `user-123`, `user-456`, `user-789`\n\n### PostgreSQL\n- **Host**: `localhost`\n- **Port**: `5432`\n- **Database**: `stacklens`\n- **User**: `stacklens_user`\n- **Password**: `stacklens_password`\n\n### Kafka\n- **Bootstrap**: `localhost:9092`\n- **Input Topic**: `stacklens-enriched`\n- **Output Topic**: `stacklens-analytics`\n- **DLQ Topic**: `analytics-dlq`\n\n### Kafka UI\n- **URL**: `http://localhost:8080`\n- **Features**: Topic monitoring, message browsing, consumer groups\n\n## Common Tasks\n\n### View Service Logs\n\n```bash\n# Enrichment Service logs\ndocker-compose -f docker-compose-phase3.yml logs -f enrichment-service\n\n# User Service logs\ndocker-compose -f docker-compose-phase3.yml logs -f enrichment-api\n\n# PostgreSQL logs\ndocker-compose -f docker-compose-phase3.yml logs -f postgres\n\n# Kafka logs\ndocker-compose -f docker-compose-phase3.yml logs -f kafka\n```\n\n### Run Tests\n\n```bash\n# Install test dependencies\npip install -r python-services/requirements-phase3.txt\npip install pytest pytest-cov\n\n# Run all tests\npytest tests/integration/test_phase3_enrichment.py -v\n\n# Run specific test class\npytest tests/integration/test_phase3_enrichment.py::TestGeoIPEnrichment -v\n\n# Run with coverage\npytest tests/integration/test_phase3_enrichment.py --cov=python-services\n```\n\n### Monitor Performance\n\n```bash\n# Watch Enrichment Service logs for statistics\ndocker-compose -f docker-compose-phase3.yml logs -f enrichment-service | grep \"Throughput\\|Cache Hit\"\n\n# Query database for metrics\npsql -h localhost -U stacklens_user -d stacklens -c \\\n  \"SELECT processed_messages, enriched_messages, error_count, throughput_msgs_per_sec FROM enrichment_metrics ORDER BY recorded_at DESC LIMIT 5;\"\n```\n\n### Check Cache Hit Rate\n\n```bash\n# Query Geo-IP cache hit rate\npsql -h localhost -U stacklens_user -d stacklens -c \\\n  \"SELECT enrichment_type, cache_hit_rate FROM enrichment_metrics WHERE enrichment_type='geo-ip' ORDER BY recorded_at DESC LIMIT 5;\"\n\n# Expected: >80%\n```\n\n### View Failed Messages\n\n```bash\n# Read messages from DLQ topic\nkafka-console-consumer --bootstrap-server localhost:9092 \\\n  --topic analytics-dlq --from-beginning\n```\n\n## Troubleshooting\n\n### Services won't start\n\n```bash\n# Check if ports are already in use\nlsof -i :8003\nlsof -i :8002\nlsof -i :5432\nlsof -i :9092\n\n# Stop conflicting services\nkill -9 <PID>\n\n# Or use different ports in docker-compose-phase3.yml\n```\n\n### Enrichment Service not consuming messages\n\n```bash\n# Check if Kafka is ready\nkafka-broker-api-versions --bootstrap-server=localhost:9092\n\n# Check enrichment service logs\ndocker-compose -f docker-compose-phase3.yml logs enrichment-service | tail -50\n\n# Restart enrichment service\ndocker-compose -f docker-compose-phase3.yml restart enrichment-service\n```\n\n### User service returning 404\n\n```bash\n# Check available mock users\ncurl http://localhost:8002/api/stats\n\n# Try with valid user ID\ncurl http://localhost:8002/api/users/user-123\n\n# Expected available users: user-123, user-456, user-789\n```\n\n## Configuration\n\nAll environment variables in `docker-compose-phase3.yml`:\n\n```yaml\nenvironment:\n  # Kafka Configuration\n  KAFKA_BOOTSTRAP_SERVERS: kafka:9092\n  KAFKA_INPUT_TOPIC: stacklens-enriched\n  KAFKA_OUTPUT_TOPIC: stacklens-analytics\n  KAFKA_DLQ_TOPIC: analytics-dlq\n  KAFKA_BATCH_SIZE: '50'\n  KAFKA_BATCH_TIMEOUT_SEC: '5'\n  \n  # Database Configuration\n  DB_HOST: postgres\n  DB_PORT: '5432'\n  DB_NAME: stacklens\n  DB_USER: stacklens_user\n  DB_PASSWORD: stacklens_password\n  DB_POOL_MAX: '5'\n  \n  # Cache Configuration\n  GEO_IP_CACHE_SIZE: '10000'\n  GEO_IP_CACHE_TTL_HOURS: '1'\n  USER_CACHE_TTL_HOURS: '1'\n  BUSINESS_CACHE_TTL_MIN: '30'\n  \n  # External Service\n  USER_SERVICE_URL: http://enrichment-api:8002\n  USER_SERVICE_TIMEOUT_SEC: '5'\n  \n  # Performance\n  MAX_THREADS: '4'\n  STATS_INTERVAL_SEC: '30'\n```\n\n## Clean Up\n\n```bash\n# Stop all services\ndocker-compose -f docker-compose-phase3.yml down\n\n# Remove volumes (warning: deletes data)\ndocker-compose -f docker-compose-phase3.yml down -v\n\n# Remove all Phase 3 images\ndocker-compose -f docker-compose-phase3.yml down --rmi all\n```\n\n## Next Steps\n\n1. **Explore Database**: Check `docs/PHASE_3_ENRICHMENT_GUIDE.md` for database schema details\n2. **Review Code**: Check `python-services/enrichment_service.py` for service implementation\n3. **Run Tests**: `pytest tests/integration/test_phase3_enrichment.py -v`\n4. **Monitoring**: Use Kafka UI (`http://localhost:8080`) to monitor topics\n5. **Performance Tuning**: See performance tuning section in main guide\n\n## Support\n\nFor detailed information, see:\n- **Architecture**: `docs/PHASE_3_ENRICHMENT_GUIDE.md` → Architecture section\n- **Configuration**: `docs/PHASE_3_ENRICHMENT_GUIDE.md` → Configuration section\n- **Troubleshooting**: `docs/PHASE_3_ENRICHMENT_GUIDE.md` → Troubleshooting section\n- **Performance**: `docs/PHASE_3_ENRICHMENT_GUIDE.md` → Performance Tuning section\n\n---\n\n**Version**: 1.0  \n**Last Updated**: 2024-01-15\n